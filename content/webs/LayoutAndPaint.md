---
date: 2024-8-29 18:29:48
url: 
aliases: 
tags:
  - Web
title: 重排和重绘
edited date: 2023-08-29 星期四
---

> 页面局部出现 “闪烁” 是一件很糟心的事，哪怕我不是这个程序的用户。

## 引出：什么是重排重绘
> [渲染页面：浏览器的工作原理 - Web 性能 | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work)

在页面上看到的内容，是通过解析“HTML”和“CSS”文件后渲染出来的。大致过程，如上图所示：
1. 解析 HTML，生成 DOM 树，解析 CSS，生成 CSSOM 树
2. 合并 DOM 树和 CSSOM 树，为 **渲染树**
3. 布局，计算渲染树所有节点的几何信息
4. 绘制，将几何信息实际转换成屏幕的像素信息（包括颜色样式）

### 定义：重排
第一次确定每个节点的大小和位置称为*布局*。随后对节点大小和位置的重新计算称为 *重排*。当重排发生时，就会引起绘制，也就是需要重新将新的几何信息转换成屏幕的像素信息。

### 影响：重排重绘很糟心
1. 频繁的重排重绘会影响程序性能
2. 用户会看见闪烁的情况

## 心得：在开发中怎么避免重排
> 分享一下思路，并非是完全的攻略

1. 较少的**动态**改变 “宽度”，“高度”等影响几何信息的操作；
2. 使用“`display: none`”，会导致元素不再占据空间，导致重排；而使用`visibility: hidden`则不会；对应到 `Vue` 中，频繁隐藏的内容使用 `v-show` 替换 `v-if`；
3. 高度或者宽度是`auto`，当图像出现自适应的情况，会导致重排，所以尽量指定高宽度；
4. 如果样式发生变化，尽量控制样式变化的范围，例如边框变化时，变化前后的粗细保持一致。
